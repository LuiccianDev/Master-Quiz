---
interface Props {
  /** Current progress value */
  value: number;
  /** Maximum value (default: 100) */
  max?: number;
  /** Height of the progress bar (default: 'sm') */
  size?: 'xs' | 'sm' | 'md' | 'lg';
  /** Border radius (default: 'full') */
  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'full';
  /** Background color (default: 'gray-200') */
  bgColor?: string;
  /** Progress bar color (default: 'gradient') */
  color?: 'primary' | 'gradient' | 'success' | 'warning' | 'danger' | 'accent';
  /** Show percentage label (default: false) */
  showLabel?: boolean;
  /** Custom label format function */
  formatLabel?: (value: number, percent: number) => string;
  /** Additional class names */
  className?: string;
}

const { 
  value,
  max = 100,
  size = 'sm',
  rounded = 'full',
  bgColor = 'bg-gray-200',
  color = 'gradient',
  showLabel = false,
  formatLabel,
  className = ''
} = Astro.props;

const percent = Math.min(100, Math.max(0, Math.round((value / max) * 100)));

const sizes = {
  xs: 'h-1',
  sm: 'h-2',
  md: 'h-3',
  lg: 'h-4'
};

const roundness = {
  none: 'rounded-none',
  sm: 'rounded',
  md: 'rounded-md',
  lg: 'rounded-lg',
  full: 'rounded-full'
};

const colors = {
  primary: 'bg-primary-600',
  gradient: 'bg-gradient-to-r from-Orange to-Accent',
  success: 'bg-green-500',
  warning: 'bg-yellow-500',
  danger: 'bg-red-500',
  accent: 'bg-blue-500'
};

const containerClasses = [
  'w-full',
  'overflow-hidden',
  bgColor,
  roundness[rounded],
  className
].filter(Boolean).join(' ');

const barClasses = [
  'h-full',
  'transition-all',
  'duration-300',
  'ease-in-out',
  roundness[rounded],
  colors[color]
].filter(Boolean).join(' ');

const labelText = formatLabel 
  ? formatLabel(value, percent)
  : `${percent}%`;
---
<div class="space-y-1 w-full">
  {showLabel && (
    <div class="flex justify-between text-sm text-gray-600">
      <span>Progress</span>
      <span class="font-medium">{labelText}</span>
    </div>
  )}
  <div class={containerClasses} style={{ height: sizes[size] }}>
    <div
      class={barClasses}
      style={`width: ${percent}%`}
      role="progressbar"
      aria-valuenow={value}
      aria-valuemin={0}
      aria-valuemax={max}
      aria-valuetext={`${percent}%`}
    ></div>
  </div>
</div>
